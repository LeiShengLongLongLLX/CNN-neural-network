# C language

# ä¸€ã€æ•°æ®ç±»å‹ (Data type)

C è¯­è¨€æ˜¯ä¸€é—¨**å¼ºç±»å‹ã€è´´è¿‘ç¡¬ä»¶çš„è¯­è¨€**

æ•°æ®ç±»å‹çš„æœ¬è´¨æ˜¯ï¼š**å‘Šè¯‰ç¼–è¯‘å™¨ä¸€æ®µå†…å­˜æœ‰å¤šå¤§ã€å¦‚ä½•è§£é‡Šè¿™æ®µå†…å­˜**

---

## 1.1 åŸºæœ¬ç±»å‹

### 1.1.1 char / short / int / long

| ç±»å‹    | æœ€å°ä½å®½ï¼ˆæ ‡å‡†ï¼‰ | å¸¸è§ä½å®½ï¼ˆ32 ä½ç³»ç»Ÿï¼‰ |
| ----- | -------- | ------------ |
| char  | â‰¥ 8 bit  | 8 bitï¼ˆ1 å­—èŠ‚ï¼‰  |
| short | â‰¥ 16 bit | 16 bitï¼ˆ2 å­—èŠ‚ï¼‰ |
| int   | â‰¥ short  | 32 bitï¼ˆ4 å­—èŠ‚ï¼‰ |
| long  | â‰¥ int    | 32 æˆ– 64 bit  |

ğŸ“Œ **æ³¨æ„**

* C æ ‡å‡†åªè§„å®š**å¤§å°å…³ç³»**ï¼Œä¸è§„å®šå…·ä½“å­—èŠ‚æ•°
* å®é™…å¤§å°**ä¸å¹³å°ã€ç¼–è¯‘å™¨æœ‰å…³**
* åµŒå…¥å¼ / RISC-V / FPGA SoC ä¸­å°¤ä¸ºé‡è¦

```c
printf("char : %zu\n", sizeof(char));
printf("int  : %zu\n", sizeof(int));
```

---

### 1.1.2 signed / unsigned

#### ï¼ˆ1ï¼‰å«ä¹‰

* `signed`ï¼šæœ‰ç¬¦å·æ•°ï¼ˆå¯è¡¨ç¤ºæ­£è´Ÿï¼‰
* `unsigned`ï¼šæ— ç¬¦å·æ•°ï¼ˆåªè¡¨ç¤ºéè´Ÿï¼‰

```c
signed int a = -10;
unsigned int b = 10;
```

#### ï¼ˆ2ï¼‰å–å€¼èŒƒå›´å·®å¼‚ï¼ˆä»¥ 32 ä½ int ä¸ºä¾‹ï¼‰

| ç±»å‹           | èŒƒå›´           |
| ------------ | ------------ |
| signed int   | -2Â³Â¹ ~ 2Â³Â¹-1 |
| unsigned int | 0 ~ 2Â³Â²-1    |

**éšå«è§„åˆ™**

* **æ•´å‹é»˜è®¤æ˜¯ signed**
* `char` æ˜¯å¦æœ‰ç¬¦å·ç”±**ç¼–è¯‘å™¨å†³å®š**ï¼ˆéå¸¸é‡è¦ï¼‰

```c
char c = -1;   // å¯èƒ½æ˜¯ -1ï¼Œä¹Ÿå¯èƒ½æ˜¯ 255
```

> **å»ºè®®ï¼šæ˜ç¡®å†™ signed / unsigned**

---

## 1.2 æµ®ç‚¹ç±»å‹

### 1.2.1 float / double

| ç±»å‹     | å¸¸è§å¤§å° | ç²¾åº¦          |
| ------ | ---- | ----------- |
| float  | 4 å­—èŠ‚ | ~6~7 ä½åè¿›åˆ¶   |
| double | 8 å­—èŠ‚ | ~15~16 ä½åè¿›åˆ¶ |

```c
float  f = 3.14f;
double d = 3.14;
```

**æ³¨æ„**

* æµ®ç‚¹æ•°åœ¨å†…å­˜ä¸­ä¸æ˜¯ç²¾ç¡®å€¼ï¼ˆIEEE 754ï¼‰
* **ä¸è¦ç›´æ¥ç”¨ `==` æ¯”è¾ƒæµ®ç‚¹æ•°**

```c
if (fabs(a - b) < 1e-6) { ... }
```

**åµŒå…¥å¼è¡¥å……**

* å¾ˆå¤š MCU / è½¯æ ¸ **æ²¡æœ‰ç¡¬ä»¶æµ®ç‚¹**
* æµ®ç‚¹è¿ç®— = æ…¢ + ä»£ç å¤§

---

## 1.3 æ´¾ç”Ÿç±»å‹

æ´¾ç”Ÿç±»å‹ï¼š**ä»åŸºæœ¬ç±»å‹â€œæ´¾ç”Ÿâ€å‡ºæ¥çš„ç±»å‹**

---

### 1.3.1 æŒ‡é’ˆï¼ˆpointerï¼‰

#### ï¼ˆ1ï¼‰å®šä¹‰

```c
int a = 10;
int *p = &a;
```

* `p` ä¿å­˜çš„æ˜¯ **a çš„åœ°å€**
* `*p` è¡¨ç¤º **è®¿é—®åœ°å€å¯¹åº”çš„å€¼**

ğŸ“Œ **æ ¸å¿ƒå…¬å¼**

> æŒ‡é’ˆ = åœ°å€ + ç±»å‹

#### ï¼ˆ2ï¼‰æŒ‡é’ˆå¤§å°

* **æ‰€æœ‰æŒ‡é’ˆå¤§å°ç›¸åŒ**
* 32 ä½ç³»ç»Ÿï¼š4 å­—èŠ‚
* 64 ä½ç³»ç»Ÿï¼š8 å­—èŠ‚

```c
sizeof(int*) == sizeof(char*)
```

---

### 1.3.2 æ•°ç»„ï¼ˆarrayï¼‰

```c
int arr[5] = {1,2,3,4,5};
```

* æ•°ç»„æ˜¯ä¸€æ®µ**è¿ç»­çš„å†…å­˜**
* `arr[i]` ç­‰ä»·äº `*(arr + i)`

**æ•°ç»„åçš„æœ¬è´¨**

* å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ•°ç»„åä¼šé€€åŒ–ä¸ºæŒ‡å‘é¦–å…ƒç´ çš„æŒ‡é’ˆ
* ä½†ï¼š

```c
sizeof(arr) != sizeof(&arr)
```

---

## 1.4 æ„é€ ç±»å‹

### 1.4.1 structï¼ˆç»“æ„ä½“ï¼‰

ç»“æ„ä½“ç”¨äº**ç»„åˆä¸åŒç±»å‹çš„æ•°æ®**

```c
struct Student {
    int id;
    char name[20];
};
```

* æˆå‘˜æŒ‰å£°æ˜é¡ºåºå­˜æ”¾
* å¯èƒ½å­˜åœ¨ **å†…å­˜å¯¹é½**

```c
struct Student s;
```

---

### 1.4.2 unionï¼ˆå…±ç”¨ä½“ï¼‰

```c
union Data {
    int i;
    float f;
};
```

* æ‰€æœ‰æˆå‘˜ **å…±ç”¨åŒä¸€å—å†…å­˜**
* å¤§å° = æœ€å¤§æˆå‘˜å¤§å°

ğŸ“Œ **ç‰¹ç‚¹**

* åŒä¸€æ—¶åˆ»åªèƒ½â€œæ­£ç¡®ä½¿ç”¨â€ä¸€ä¸ªæˆå‘˜
* å¸¸ç”¨äºï¼š

  * åè®®è§£æ
  * å¯„å­˜å™¨æ˜ å°„

---

## 1.5 void ç±»å‹

### 1.5.1 void çš„ä¸‰ç§å¸¸è§ç”¨æ³•

#### ï¼ˆ1ï¼‰å‡½æ•°æ— è¿”å›å€¼

```c
void func(void);
```

#### ï¼ˆ2ï¼‰é€šç”¨æŒ‡é’ˆ

```c
void *p;
```

* `void*` å¯ä»¥æŒ‡å‘ä»»ä½•ç±»å‹
* **ä¸èƒ½ç›´æ¥è§£å¼•ç”¨**

```c
int a = 10;
void *p = &a;
printf("%d", *(int*)p);
```

#### ï¼ˆ3ï¼‰å‡½æ•°å‚æ•°ä¸ºç©º

```c
int func(void);
```

---

## 1.6 sizeof çš„æœ¬è´¨ï¼ˆå’Œå¹³å°æœ‰å…³ï¼‰

### 1.6.1 sizeof æ˜¯ä»€ä¹ˆ

* **ç¼–è¯‘æœŸè¿ç®—ç¬¦**
* è¿”å›ç±»å‹æˆ–å¯¹è±¡æ‰€å çš„**å­—èŠ‚æ•°**

```c
sizeof(int)
sizeof(a)
```

> æ³¨ï¼š **ä¸æ˜¯å‡½æ•°**

---

### 1.6.2 sizeof ä¸å¹³å°

| å¹³å°   | æŒ‡é’ˆ | int | long |
| ---- | -- | --- | ---- |
| 32 ä½ | 4  | 4   | 4    |
| 64 ä½ | 8  | 4   | 8    |

#### **å¸¸è§å‘**

```c
int arr[10];
sizeof(arr);     // 40
sizeof(arr + 0); // 8ï¼ˆæŒ‡é’ˆï¼‰
```

---

## 1.7 æ€»ç»“

> **C è¯­è¨€çš„æ•°æ®ç±»å‹ï¼Œæœ¬è´¨æ˜¯åœ¨â€œæè¿°å†…å­˜â€å’Œâ€œå¦‚ä½•è§£é‡Šå†…å­˜â€**

---

## äºŒã€å˜é‡
### 2.1 å˜é‡çš„å®šä¹‰ä¸å£°æ˜
### 2.2 å˜é‡çš„ä½œç”¨åŸŸ
  - å±€éƒ¨å˜é‡
  - å…¨å±€å˜é‡
### 2.3 ç”Ÿå‘½å‘¨æœŸ
### 2.4 static å˜é‡
### 2.5 extern å˜é‡
### 2.6 volatile

---

# äºŒã€å˜é‡ (Varible)

å˜é‡çš„æœ¬è´¨æ˜¯ï¼š

> **åœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€å—ç©ºé—´ï¼Œå¹¶ç»™è¿™å—ç©ºé—´èµ·ä¸€ä¸ªåå­—**

ç†è§£å˜é‡ï¼Œå¿…é¡»åŒæ—¶ç†è§£ï¼š

* **ä½œç”¨åŸŸï¼ˆèƒ½åœ¨å“ªç”¨ï¼‰**
* **ç”Ÿå‘½å‘¨æœŸï¼ˆä»€ä¹ˆæ—¶å€™å­˜åœ¨ï¼‰**
* **å­˜å‚¨ä½ç½®ï¼ˆåœ¨å“ªå—å†…å­˜ï¼‰**

---

## 2.1 å˜é‡çš„å®šä¹‰ä¸å£°æ˜

### 2.1.1 å˜é‡å®šä¹‰ï¼ˆDefinitionï¼‰

**å®šä¹‰ = åˆ†é…å†…å­˜**

```c
int a;
```

* ç¼–è¯‘å™¨ä¸º `a` åˆ†é…å†…å­˜ç©ºé—´
* å˜é‡çœŸæ­£â€œå­˜åœ¨â€äº†

---

### 2.1.2 å˜é‡å£°æ˜ï¼ˆDeclarationï¼‰

**å£°æ˜ = å‘Šè¯‰ç¼–è¯‘å™¨å˜é‡å­˜åœ¨ï¼Œä½†ä¸åˆ†é…å†…å­˜**

```c
extern int a;
```

### 2.1.3 æ ¸å¿ƒåŒºåˆ«

| é¡¹ç›®     | å®šä¹‰ | å£°æ˜ |
| ------ | -- | -- |
| æ˜¯å¦åˆ†é…å†…å­˜ | âœ…  | âŒ  |
| æ˜¯å¦å¯å¤šæ¬¡  | âŒ  | âœ…  |

> **æ³¨æ„ï¼š**
> 
> * æ™®é€š `int a;` æ—¢æ˜¯å£°æ˜ä¹Ÿæ˜¯å®šä¹‰
> * `extern` æ‰æ˜¯çº¯å£°æ˜

---

## 2.2 å˜é‡çš„ä½œç”¨åŸŸï¼ˆScopeï¼‰

ä½œç”¨åŸŸå†³å®šï¼š

> **å˜é‡åœ¨ä»£ç ä¸­â€œèƒ½è¢«è®¿é—®çš„èŒƒå›´â€**

---

### 2.2.1 å±€éƒ¨å˜é‡

```c
void func(void)
{
    int x = 10;
}
```

* å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨æˆ–ä»£ç å—ä¸­
* åªèƒ½åœ¨æ‰€åœ¨ä»£ç å—ä¸­ä½¿ç”¨

#### **ç‰¹ç‚¹**

* å­˜åœ¨äºæ ˆä¸­
* ä¸åˆå§‹åŒ–æ—¶æ˜¯**éšæœºå€¼**

---

### 2.2.2 å…¨å±€å˜é‡

```c
int g_val = 100;

void func(void)
{
    printf("%d", g_val);
}
```

* å®šä¹‰åœ¨å‡½æ•°å¤–
* æ•´ä¸ªå·¥ç¨‹å¯è§ï¼ˆéœ€é…åˆ `extern`ï¼‰

#### **ç‰¹ç‚¹**

* å­˜æ”¾åœ¨ **å…¨å±€åŒºï¼ˆ.data / .bssï¼‰**
* ç”Ÿå‘½å‘¨æœŸè´¯ç©¿æ•´ä¸ªç¨‹åº

---

## 2.3 ç”Ÿå‘½å‘¨æœŸï¼ˆLifetimeï¼‰

ç”Ÿå‘½å‘¨æœŸæè¿°çš„æ˜¯ï¼š

> **å˜é‡ä»â€œåˆ›å»ºâ€åˆ°â€œé”€æ¯â€çš„æ—¶é—´**

---

### 2.3.1 å±€éƒ¨å˜é‡ç”Ÿå‘½å‘¨æœŸ

```c
void func(void)
{
    int a = 10;
}   // a åœ¨è¿™é‡Œè¢«é”€æ¯
```

* è¿›å…¥å‡½æ•°ï¼šåˆ›å»º
* ç¦»å¼€å‡½æ•°ï¼šé”€æ¯

> æ³¨ï¼š**æ ˆå˜é‡**

---

### 2.3.2 å…¨å±€å˜é‡ç”Ÿå‘½å‘¨æœŸ

```c
int g = 0;
```

* ç¨‹åºå¼€å§‹ â†’ ç¨‹åºç»“æŸ
* å§‹ç»ˆå­˜åœ¨

> æ³¨ï¼š**ä¸ main æ˜¯å¦æ‰§è¡Œæ— å…³**

---

## 2.4 static å˜é‡ï¼ˆé™æ€å˜é‡ï¼‰

`static` æ˜¯ C è¯­è¨€ä¸­**æå…¶é‡è¦ã€ææ˜“æ··æ·†**çš„å…³é”®å­—ã€‚

---

### 2.4.1 static ä¿®é¥°å±€éƒ¨å˜é‡

```c
void func(void)
{
    static int cnt = 0;
    cnt++;
}
```

ğŸ“Œ **ç‰¹ç‚¹**

* åªåˆå§‹åŒ–ä¸€æ¬¡
* ç”Ÿå‘½å‘¨æœŸ = æ•´ä¸ªç¨‹åº
* ä½œç”¨åŸŸ = è¯¥å‡½æ•°å†…éƒ¨

#### **å…¸å‹ç”¨é€”**

* å‡½æ•°å†…éƒ¨è®¡æ•°å™¨
* çŠ¶æ€ä¿æŒ

---

### 2.4.2 static ä¿®é¥°å…¨å±€å˜é‡

```c
static int g_val = 10;
```

#### **ç‰¹ç‚¹**

* ä½œç”¨åŸŸé™åˆ¶åœ¨å½“å‰ `.c` æ–‡ä»¶
* é˜²æ­¢å…¨å±€å˜é‡â€œæ±¡æŸ“â€å…¶ä»–æ–‡ä»¶

#### **å·¥ç¨‹çº§æœ€ä½³å®è·µ**

> èƒ½ static å°± static

---

### 2.4.3 static ä¿®é¥°å‡½æ•°

```c
static void helper(void)
{
}
```

* å‡½æ•°ä»…åœ¨æœ¬æ–‡ä»¶å¯è§
* ä¸ä¼šè¢«å…¶ä»–æ–‡ä»¶é“¾æ¥

---

## 2.5 extern å˜é‡

`extern` ç”¨äºï¼š

> **åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨å¦ä¸€ä¸ªæ–‡ä»¶å®šä¹‰çš„å˜é‡**

---

### 2.5.1 ä½¿ç”¨æ–¹æ³•

**a.c**

```c
int g_data = 100;
```

**b.c**

```c
extern int g_data;
```

---

### 2.5.2 extern çš„æœ¬è´¨

* åªæ˜¯**å£°æ˜**
* ä¸åˆ†é…å†…å­˜
* ç”±é“¾æ¥å™¨è§£å†³ç¬¦å·

#### **å¸¸è§é”™è¯¯**

```c
extern int x = 10;  // âŒ è¿™æ˜¯å®šä¹‰ï¼Œä¸æ˜¯å£°æ˜
```

---

## 2.6 volatileï¼ˆåµŒå…¥å¼é‡ç‚¹ï¼‰

`volatile` å‘Šè¯‰ç¼–è¯‘å™¨ï¼š

> **è¿™ä¸ªå˜é‡çš„å€¼å¯èƒ½éšæ—¶è¢«â€œä¸å¯é¢„çŸ¥åœ°æ”¹å˜â€**

---

### 2.6.1 ä¸ºä»€ä¹ˆéœ€è¦ volatile

```c
while (flag == 0) {
}
```

å¦‚æœ `flag` æ²¡æœ‰ `volatile`ï¼š

* ç¼–è¯‘å™¨å¯èƒ½ä¼˜åŒ–æˆæ­»å¾ªç¯

---

### 2.6.2 volatile çš„å…¸å‹ä½¿ç”¨åœºæ™¯

1. **ç¡¬ä»¶å¯„å­˜å™¨**

```c
#define GPIO (*(volatile unsigned int*)0x40000000)
```

2. **ä¸­æ–­å…±äº«å˜é‡**

```c
volatile int irq_flag;
```

3. **å¤šçº¿ç¨‹ / å¤šæ ¸é€šä¿¡**

---

### 2.6.3 volatile çš„é™åˆ¶

`volatile` **ä¸èƒ½ä¿è¯**

* åŸå­æ€§
* çº¿ç¨‹å®‰å…¨

åªä¿è¯ï¼š

* **æ¯æ¬¡éƒ½ä»å†…å­˜è¯»å†™**

---

## 2.7 æ€»ç»“

| å…³é”®å­—      | ä½œç”¨         |
| -------- | ---------- |
| auto     | é»˜è®¤å±€éƒ¨å˜é‡     |
| static   | æ”¹å˜ç”Ÿå‘½å‘¨æœŸæˆ–å¯è§æ€§ |
| extern   | è·¨æ–‡ä»¶è®¿é—®å˜é‡    |
| volatile | ç¦æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–    |

> **å˜é‡ = åå­— + å†…å­˜ + ä½œç”¨åŸŸ + ç”Ÿå‘½å‘¨æœŸ**

---

# ä¸‰ã€å‡½æ•° (Function)

å‡½æ•°çš„æœ¬è´¨æ˜¯ï¼š

> **ä¸€æ®µå¯å¤ç”¨çš„ä»£ç  + ç‹¬ç«‹çš„æ ˆå¸§ + æ˜ç¡®çš„è¾“å…¥è¾“å‡º**

ç†è§£å‡½æ•°ï¼Œå…³é”®ä¸åœ¨â€œä¼šä¸ä¼šå†™â€ï¼Œè€Œåœ¨ï¼š

* å‚æ•°æ˜¯æ€ä¹ˆä¼ çš„
* è¿”å›å€¼ä»å“ªæ¥
* è°ƒç”¨æ—¶å†…å­˜å‘ç”Ÿäº†ä»€ä¹ˆ

---

## 3.1 å‡½æ•°å®šä¹‰ä¸å£°æ˜

### 3.1.1 å‡½æ•°å®šä¹‰ï¼ˆDefinitionï¼‰

```c
int add(int a, int b)
{
    return a + b;
}
```

å‡½æ•°å®šä¹‰åŒ…å«ï¼š

* è¿”å›ç±»å‹
* å‡½æ•°å
* å‚æ•°åˆ—è¡¨
* å‡½æ•°ä½“

> æ³¨ï¼š**å‡½æ•°å®šä¹‰åªèƒ½æœ‰ä¸€æ¬¡**

---

### 3.1.2 å‡½æ•°å£°æ˜ï¼ˆDeclarationï¼‰

```c
int add(int a, int b);
```

ä½œç”¨ï¼š

* å‘Šè¯‰ç¼–è¯‘å™¨å‡½æ•°çš„æ¥å£
* ä¸ç”Ÿæˆå‡½æ•°å®ä½“

> **å£°æ˜å¯ä»¥å¤šæ¬¡**
> 
> å¸¸æ”¾åœ¨ `.h` æ–‡ä»¶ä¸­

---

### 3.1.3 å‡½æ•°å£°æ˜ä¸å®šä¹‰çš„å…³ç³»

```c
int add(int a, int b);  // å£°æ˜

int main(void)
{
    add(1, 2);
}

int add(int a, int b)  // å®šä¹‰
{
    return a + b;
}
```

---

## 3.2 å‚æ•°ä¼ é€’

é‡è¦ç»“è®ºå…ˆç»™å‡º

> **C è¯­è¨€åªæœ‰å€¼ä¼ é€’ï¼Œæ²¡æœ‰å¼•ç”¨ä¼ é€’**

æ‰€è°“â€œæŒ‡é’ˆä¼ é€’â€ï¼Œæœ¬è´¨ä»ç„¶æ˜¯å€¼ä¼ é€’ã€‚

---

### 3.2.1 å€¼ä¼ é€’

```c
void func(int x)
{
    x = 100;
}

int main(void)
{
    int a = 10;
    func(a);
}
```

* `x` æ˜¯ `a` çš„æ‹·è´
* ä¿®æ”¹ `x` ä¸å½±å“ `a`

> æœ¬è´¨ï¼š **å‚æ•°åœ¨æ ˆä¸Šé‡æ–°å¼€è¾Ÿç©ºé—´**

---

### 3.2.2 æŒ‡é’ˆä¼ é€’ï¼ˆæœ¬è´¨ä»æ˜¯å€¼ä¼ é€’ï¼‰

```c
void func(int *p)
{
    *p = 100;
}

int main(void)
{
    int a = 10;
    func(&a);
}
```

* ä¼ çš„æ˜¯ **åœ°å€çš„å€¼**
* é€šè¿‡åœ°å€ä¿®æ”¹äº†åŸå˜é‡

**è®°ä½è¿™å¥è¯**

> æŒ‡é’ˆä¼ é€’ = åœ°å€çš„å€¼ä¼ é€’

---

## 3.3 è¿”å›å€¼

### 3.3.1 åŸºæœ¬è¿”å›å€¼

```c
int add(int a, int b)
{
    return a + b;
}
```

* è¿”å›å€¼é€šè¿‡å¯„å­˜å™¨ä¼ é€’ï¼ˆå¦‚ RISC-Vï¼š`a0`ï¼‰
* `return` ä¼šè§¦å‘å‡½æ•°è¿”å›

---

### 3.3.2 è¿”å›æŒ‡é’ˆï¼ˆå¸¸è§é™·é˜±ï¼‰

é”™è¯¯ç¤ºä¾‹ï¼š

```c
int* func(void)
{
    int a = 10;
    return &a;  // âŒ è¿”å›å±€éƒ¨å˜é‡åœ°å€
}
```

åŸå› ï¼š

* `a` åœ¨æ ˆä¸Š
* å‡½æ•°è¿”å›åæ ˆå¸§è¢«é”€æ¯

---

### 3.3.3 æ­£ç¡®è¿”å›æ–¹å¼

```c
static int a = 10;
return &a;
```

æˆ–

```c
int *p = malloc(sizeof(int));
return p;
```

---

## 3.4 æ ˆå¸§ï¼ˆå‡½æ•°è°ƒç”¨å‘ç”Ÿäº†ä»€ä¹ˆï¼‰

è¿™æ˜¯**ç†è§£å‡½æ•°çš„å…³é”®éƒ¨åˆ†**ã€‚

---

### 3.4.1 ä»€ä¹ˆæ˜¯æ ˆå¸§ï¼ˆStack Frameï¼‰

æ ˆå¸§åŒ…å«ï¼š

* è¿”å›åœ°å€
* å‚æ•°
* å±€éƒ¨å˜é‡
* ä¿å­˜çš„å¯„å­˜å™¨

**æ¯è°ƒç”¨ä¸€æ¬¡å‡½æ•°ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ ˆå¸§**

---

### 3.4.2 å‡½æ•°è°ƒç”¨æµç¨‹ï¼ˆç®€åŒ–ï¼‰

```text
caller:
  â†“ å‹å‚æ•°
  â†“ ä¿å­˜è¿”å›åœ°å€
  â†“ è·³è½¬åˆ°è¢«è°ƒå‡½æ•°

callee:
  â†“ åˆ›å»ºæ ˆå¸§
  â†“ æ‰§è¡Œå‡½æ•°ä½“
  â†“ é”€æ¯æ ˆå¸§
  â†“ è¿”å›
```

> é€’å½’æœ¬è´¨ = å¤šä¸ªæ ˆå¸§å åŠ 

---

### 3.4.3 æ ˆæº¢å‡º

* é€’å½’å¤ªæ·±
* å±€éƒ¨æ•°ç»„å¤ªå¤§

åµŒå…¥å¼ä¸­å°¤å…¶å±é™©

---

## 3.5 inline

`inline` ç”¨äºï¼š

> **å»ºè®®ç¼–è¯‘å™¨å°†å‡½æ•°è°ƒç”¨å±•å¼€æˆä»£ç **

---

### 3.5.1 ä½¿ç”¨æ–¹å¼

```c
inline int add(int a, int b)
{
    return a + b;
}
```

**æ³¨æ„**

* `inline` æ˜¯å»ºè®®ï¼Œä¸æ˜¯å¼ºåˆ¶
* å¯èƒ½è¢«ç¼–è¯‘å™¨å¿½ç•¥

---

### 3.5.2 inline çš„ä¼˜ç¼ºç‚¹

#### ä¼˜ç‚¹ï¼š

* å‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€

#### ç¼ºç‚¹ï¼š

* å¢åŠ ä»£ç ä½“ç§¯
* ä¸åˆ©äºè°ƒè¯•

#### **åµŒå…¥å¼å»ºè®®**

* å°å‡½æ•°
* é«˜é¢‘è°ƒç”¨
* æ”¾åœ¨ `.h`

---

## 3.6 é€’å½’

é€’å½’ = å‡½æ•°è°ƒç”¨è‡ªèº«ã€‚

---

### 3.6.1 é€’å½’ä¸‰è¦ç´ 

1. é€’å½’è°ƒç”¨
2. ç»ˆæ­¢æ¡ä»¶
3. é—®é¢˜è§„æ¨¡ç¼©å°

```c
int factorial(int n)
{
    if (n == 0)
        return 1;
    return n * factorial(n - 1);
}
```

---

### 3.6.2 é€’å½’çš„é£é™©

* å ç”¨å¤§é‡æ ˆç©ºé—´
* æ˜“å¯¼è‡´æ ˆæº¢å‡º

> **åµŒå…¥å¼ä¸­æ…ç”¨é€’å½’**

---

## 3.7 æ€»ç»“

| é¡¹ç›®     | è¦ç‚¹     |
| ------ | ------ |
| å‚æ•°ä¼ é€’   | åªæœ‰å€¼ä¼ é€’  |
| æ ˆå¸§     | æ¯æ¬¡è°ƒç”¨ç‹¬ç«‹ |
| è¿”å›å€¼    | ä¸è¿”å›æ ˆåœ°å€ |
| inline | å»ºè®®ï¼Œä¸ä¿è¯ |
| é€’å½’     | æœ¬è´¨æ˜¯æ ˆ   |

> **å‡½æ•°è°ƒç”¨ = å‹æ ˆ â†’ æ‰§è¡Œ â†’ å‡ºæ ˆ**

---

# å››ã€æ•°ç»„ (Array)

æ•°ç»„çš„æœ¬è´¨ä¸€å¥è¯å…ˆç»™å‡ºï¼š

> **æ•°ç»„ = ä¸€æ®µâ€œè¿ç»­ã€åŒç±»å‹ã€å›ºå®šå¤§å°â€çš„å†…å­˜ç©ºé—´**

ç†è§£æ•°ç»„ï¼Œå…³é”®ä¸æ˜¯ä¸‹æ ‡ï¼Œè€Œæ˜¯ï¼š

* å†…å­˜è¿ç»­æ€§
* ä¸æŒ‡é’ˆçš„å…³ç³»
* åœ¨å‡½æ•°ä¸­çš„â€œé€€åŒ–è¡Œä¸ºâ€

---

## 4.1 ä¸€ç»´æ•°ç»„

### 4.1.1 å®šä¹‰ä¸åˆå§‹åŒ–

```c
int arr[5];                  // æœªåˆå§‹åŒ–
int arr2[5] = {1,2,3,4,5};   // å®Œå…¨åˆå§‹åŒ–
int arr3[5] = {1,2};         // éƒ¨åˆ†åˆå§‹åŒ–
```

**è§„åˆ™**

* æœªæ˜¾å¼åˆå§‹åŒ– â†’ å€¼ä¸ç¡®å®šï¼ˆå±€éƒ¨æ•°ç»„ï¼‰
* å…¨å±€æ•°ç»„ / static æ•°ç»„ â†’ é»˜è®¤åˆå§‹åŒ–ä¸º 0

---

### 4.1.2 è®¿é—®æ–¹å¼

```c
arr[i] == *(arr + i)
```

> **æ•°ç»„è®¿é—®æœ¬è´¨æ˜¯æŒ‡é’ˆè¿ç®—**

---

### 4.1.3 æ•°ç»„ç±»å‹

> æ•°ç»„çš„ç±»å‹ = å…ƒç´ ç±»å‹ + å…ƒç´ ä¸ªæ•°

```ini
ArrayType = ElementType Ã— Length
```

---

## 4.2 å¤šç»´æ•°ç»„

### 4.2.1 å®šä¹‰

```c
int a[2][3] = {
    {1,2,3},
    {4,5,6}
};
```

* æœ¬è´¨æ˜¯ï¼š**æ•°ç»„çš„æ•°ç»„**
* æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„

---

### 4.2.2 å¤šç»´æ•°ç»„çš„å­˜å‚¨é¡ºåº

C è¯­è¨€ä½¿ç”¨ **è¡Œä¼˜å…ˆï¼ˆRow-majorï¼‰** å­˜å‚¨ï¼š

```text
a[0][0] a[0][1] a[0][2] a[1][0] a[1][1] a[1][2]
```

å†…å­˜ä»ç„¶æ˜¯ **è¿ç»­çš„ä¸€å—**

---

### 4.2.3 å¤šç»´æ•°ç»„çš„æŒ‡é’ˆç±»å‹ï¼ˆå®¹æ˜“é”™ï¼‰

```c
int (*p)[3] = a;
```

* `p` æ˜¯ **æŒ‡å‘â€œé•¿åº¦ä¸º 3 çš„ int æ•°ç»„â€çš„æŒ‡é’ˆ**
* ä¸æ˜¯ `int**`

---

## 4.3 æ•°ç»„åœ¨å†…å­˜ä¸­çš„å¸ƒå±€

### 4.3.1 è¿ç»­æ€§

```c
int arr[4];
```

å†…å­˜å¸ƒå±€ï¼š

```
| arr[0] | arr[1] | arr[2] | arr[3] |
```

å…ƒç´ ä¹‹é—´ **æ— ç©ºéš™**

---

### 4.3.2 åœ°å€å…³ç³»

```c
&arr[0] == arr
&arr[i] == arr + i
```

æ­¥é•¿ç”± **å…ƒç´ ç±»å‹å†³å®š**

---

### 4.3.3 æ•°ç»„ä¸å†…å­˜åŒºåŸŸ

| æ•°ç»„ç±»å‹          | å­˜å‚¨ä½ç½®         |
| ------------- | ------------ |
| å±€éƒ¨æ•°ç»„          | æ ˆ            |
| static / å…¨å±€æ•°ç»„ | .data / .bss |

---

## 4.4 æ•°ç»„åçš„æœ¬è´¨

è¿™æ˜¯**æœ¬ç« æœ€é‡è¦çš„ä¸€èŠ‚**ã€‚

---

### 4.4.1 æ•°ç»„å â‰  æ™®é€šå˜é‡

```c
int arr[10];
```

#### æ•°ç»„åçš„ä¸‰ä¸ªç‰¹ç‚¹ï¼š

1. ä»£è¡¨ **é¦–å…ƒç´ åœ°å€**
2. **ä¸èƒ½è¢«èµ‹å€¼**
3. **ä¸æ˜¯å·¦å€¼**

```c
arr = other;   // âŒ
```

---

### 4.4.2 æ•°ç»„åä½•æ—¶â€œé€€åŒ–â€ä¸ºæŒ‡é’ˆï¼Ÿ

åœ¨ä»¥ä¸‹åœºæ™¯ä¸­ï¼š

* ä½œä¸ºå‡½æ•°å‚æ•°
* è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼ˆé sizeof / &ï¼‰

```c
sizeof(arr);    // æ•°ç»„æ€»å¤§å°
sizeof(arr+0);  // æŒ‡é’ˆå¤§å°
```

---

### 4.4.3 &arr çš„ç‰¹æ®Šæ€§ï¼ˆè¿›é˜¶ï¼‰

```c
&arr      // ç±»å‹ï¼šint (*)[10]
arr       // ç±»å‹ï¼šint*
```

æ­¥é•¿ä¸åŒï¼š

* `arr + 1` â†’ ç§»åŠ¨ä¸€ä¸ªå…ƒç´ 
* `&arr + 1` â†’ è·³è¿‡æ•´ä¸ªæ•°ç»„

---

## 4.5 æ•°ç»„ä½œä¸ºå‡½æ•°å‚æ•°

### 4.5.1 ä¸€ç»´æ•°ç»„ä½œä¸ºå‚æ•°

```c
void func(int arr[])
```

ç­‰ä»·äºï¼š

```c
void func(int *arr)
```

**æ•°ç»„ä½œä¸ºå‚æ•°ä¼šé€€åŒ–ä¸ºæŒ‡é’ˆ**

---

### 4.5.2 sizeof çš„é™·é˜±

```c
void func(int arr[])
{
    sizeof(arr);  // âŒ å¾—åˆ°çš„æ˜¯æŒ‡é’ˆå¤§å°
}
```

**å‡½æ•°ä¸­æ— æ³•è·å–æ•°ç»„çœŸå®é•¿åº¦**

---

### 4.5.3 æ­£ç¡®ä¼ é€’æ•°ç»„é•¿åº¦

```c
void func(int *arr, int len)
{
}
```

---

### 4.5.4 å¤šç»´æ•°ç»„ä½œä¸ºå‚æ•°ï¼ˆé‡ç‚¹ï¼‰

```c
void func(int arr[][3])
```

æˆ–

```c
void func(int (*arr)[3])
```

**é™¤ç¬¬ä¸€ç»´å¤–ï¼Œå…¶ä½™ç»´åº¦å¿…é¡»æ˜ç¡®**

---

## 4.6 æ€»ç»“

1. æ•°ç»„åä¸æ˜¯æŒ‡é’ˆï¼Œä½†ä¼šé€€åŒ–
2. `sizeof(arr)` å’Œ `sizeof(arr[])` ç»“æœä¸åŒ
3. å¤šç»´æ•°ç»„ â‰  äºŒçº§æŒ‡é’ˆ
4. æ•°ç»„è¶Šç•Œæ˜¯æœªå®šä¹‰è¡Œä¸º

> **æ•°ç»„æ˜¯â€œè¿ç»­å†…å­˜â€ï¼ŒæŒ‡é’ˆæ˜¯â€œè®¿é—®æ–¹å¼â€**

---

# äº”ã€æŒ‡é’ˆ (Pin)

ä¸€å¥è¯å…ˆç»™å‡ºæŒ‡é’ˆçš„æœ¬è´¨ï¼š

> **æŒ‡é’ˆ = å­˜å‚¨â€œåœ°å€â€çš„å˜é‡ + æ˜ç¡®çš„ç±»å‹**

ç†è§£æŒ‡é’ˆï¼Œå…³é”®åœ¨ä¸¤ç‚¹ï¼š

1. æŒ‡é’ˆé‡Œå­˜çš„æ˜¯ä»€ä¹ˆ
2. ç¼–è¯‘å™¨å¦‚ä½•ç”¨â€œæŒ‡é’ˆç±»å‹â€è§£é‡Šè¿™å—åœ°å€

---

## 5.1 æŒ‡é’ˆçš„åŸºæœ¬æ¦‚å¿µ

### 5.1.1 ä»€ä¹ˆæ˜¯æŒ‡é’ˆ

```c
int a = 10;
int *p = &a;
```

* `a`ï¼šæ™®é€šå˜é‡ï¼Œå­˜çš„æ˜¯å€¼
* `p`ï¼šæŒ‡é’ˆå˜é‡ï¼Œå­˜çš„æ˜¯ **a çš„åœ°å€**
* `*p`ï¼šå¯¹åœ°å€è§£å¼•ç”¨ï¼Œè®¿é—®åœ°å€é‡Œçš„å†…å®¹

#### **ä¸‰ä»¶äº‹ä¸€å®šè¦åˆ†æ¸…**

* `a`ï¼šå€¼
* `&a`ï¼šåœ°å€
* `*p`ï¼šåœ°å€å¯¹åº”çš„å€¼

---

### 5.1.2 æŒ‡é’ˆçš„ç±»å‹

```c
int    *p1;
char   *p2;
double *p3;
```

**æŒ‡é’ˆç±»å‹çš„æ„ä¹‰**

* å†³å®šï¼š

  * è§£å¼•ç”¨æ—¶è¯»å¤šå°‘å­—èŠ‚
  * æŒ‡é’ˆåŠ å‡çš„æ­¥é•¿

> **æŒ‡é’ˆç±»å‹ â‰  åœ°å€å¤§å°**

---

## 5.2 æŒ‡é’ˆä¸å˜é‡

### 5.2.1 æŒ‡é’ˆæŒ‡å‘å˜é‡

```c
int a = 10;
int *p = &a;
```

* `p` æŒ‡å‘ `a`
* é€šè¿‡ `p` å¯ä¿®æ”¹ `a`

```c
*p = 20;
```

---

### 5.2.2 æŒ‡é’ˆä½œä¸ºå˜é‡æœ¬èº«

```c
int *p;
```

* `p` æœ¬èº«ä¹Ÿæ˜¯å˜é‡
* å ç”¨å†…å­˜ï¼ˆ4 / 8 å­—èŠ‚ï¼‰

**æœªåˆå§‹åŒ–çš„æŒ‡é’ˆæ˜¯é‡æŒ‡é’ˆ**

---

## 5.3 æŒ‡é’ˆä¸æ•°ç»„

è¿™æ˜¯**æŒ‡é’ˆæœ€é‡è¦ã€æœ€å®¹æ˜“æ··çš„å…³ç³»**ã€‚

---

### 5.3.1 æ•°ç»„åä¸æŒ‡é’ˆ

```c
int arr[5];
int *p = arr;
```

è¯´æ˜ï¼š

* `arr` é€€åŒ–ä¸º `&arr[0]`
* `p` æŒ‡å‘æ•°ç»„é¦–å…ƒç´ 

---

### 5.3.2 æŒ‡é’ˆè®¿é—®æ•°ç»„

```c
p[i] == *(p + i)
```

**æ•°ç»„ä¸‹æ ‡æœ¬è´¨æ˜¯æŒ‡é’ˆè¿ç®—**

---

### 5.3.3 æŒ‡é’ˆ vs æ•°ç»„ï¼ˆæœ¬è´¨åŒºåˆ«ï¼‰

| é¡¹ç›®      | æ•°ç»„    | æŒ‡é’ˆ    |
| ------- | ----- | ----- |
| æ˜¯å¦å¯é‡æ–°æŒ‡å‘ | âŒ     | âœ…     |
| sizeof  | æ•´ä¸ªæ•°ç»„  | æŒ‡é’ˆå¤§å°  |
| å†…å­˜åˆ†é…    | ç¼–è¯‘æœŸå›ºå®š | è¿è¡ŒæœŸå¯å˜ |

---

### 5.3.4 æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼ˆè¿›é˜¶ï¼‰

```c
int (*p)[5];
```

* `p` æŒ‡å‘ **æ•´ä¸ªæ•°ç»„**
* æ­¥é•¿ = `sizeof(int[5])`

---

## 5.4 æŒ‡é’ˆä¸å‡½æ•°

---

### 5.4.1 æŒ‡é’ˆä½œä¸ºå‡½æ•°å‚æ•°

```c
void func(int *p)
{
    *p = 100;
}
```

å¸¸ç”¨äºï¼š

* ä¿®æ”¹å®å‚
* ä¼ é€’å¤§å¯¹è±¡
* è¿”å›å¤šä¸ªç»“æœ

---

### 5.4.2 å‡½æ•°è¿”å›æŒ‡é’ˆ

âŒ é”™è¯¯ï¼š

```c
int* func(void)
{
    int a = 10;
    return &a;
}
```

#### ä¸ºä»€ä¹ˆé”™ï¼Ÿ

`x` æ˜¯**æ ˆå˜é‡**

å‡½æ•°è¿”å›åï¼šæ ˆå¸§é”€æ¯, `x`çš„å†…å­˜æ— æ•ˆ, è¿”å›çš„æ˜¯æ‚¬ç©ºæŒ‡é’ˆ

è¿”å›æ ˆå˜é‡åœ°å€ â†’ æ‚¬ç©ºæŒ‡é’ˆ

---

### 5.4.3 å‡½æ•°æŒ‡é’ˆ

```c
int add(int a, int b);
int (*fp)(int, int) = add;
```

ç”¨é€”ï¼š

* å›è°ƒå‡½æ•°
* çŠ¶æ€æœº
* é©±åŠ¨æ¥å£

---

## 5.5 æŒ‡é’ˆä¸ç»“æ„ä½“

### 5.5.1 ç»“æ„ä½“æŒ‡é’ˆ

```c
struct Student {
    int id;
};

struct Student s;
struct Student *p = &s;
```

---

### 5.5.2 `->` è¿ç®—ç¬¦

```c
p->id == (*p).id
```

ğŸ“Œ **è¯­æ³•ç³–**

---

### 5.5.3 åµŒå…¥å¼ä¸­çš„å…¸å‹ç”¨æ³•

```c
#define UART0 ((volatile struct uart_reg *)0x40000000)
```

> **å¯„å­˜å™¨æ˜ å°„**

---

## 5.6 äºŒçº§æŒ‡é’ˆ

### 5.6.1 å®šä¹‰

```c
int **pp;
```

* `pp` â†’ æŒ‡å‘ä¸€ä¸ªæŒ‡é’ˆ
* å¸¸è§äºï¼š

  * ä¿®æ”¹æŒ‡é’ˆæœ¬èº«
  * åŠ¨æ€äºŒç»´æ•°ç»„
  * å‚æ•°è¾“å‡º

---

### 5.6.2 ç¤ºä¾‹ï¼šä¿®æ”¹æŒ‡é’ˆ

```c
void alloc(int **p)
{
    *p = malloc(sizeof(int));
}
```

---

## 5.7 é‡æŒ‡é’ˆ / æ‚¬ç©ºæŒ‡é’ˆ

### 5.7.1 é‡æŒ‡é’ˆ

```c
int *p;
```

* æœªåˆå§‹åŒ–
* æŒ‡å‘æœªçŸ¥åœ°å€

---

### 5.7.2 æ‚¬ç©ºæŒ‡é’ˆ

```c
int *p = malloc(sizeof(int));
free(p);
// p ä»ç„¶æŒ‡å‘å·²é‡Šæ”¾å†…å­˜
```

---

### 5.7.3 é¢„é˜²æ–¹æ³•

```c
p = NULL;
```

è®¿é—® NULL å¯å¿«é€Ÿæš´éœ²é”™è¯¯

---

## 5.8 æ€»ç»“

1. æŒ‡é’ˆå¿…é¡»åˆå§‹åŒ–
2. ä¸è¦è¿”å›æ ˆåœ°å€
3. æŒ‡é’ˆç±»å‹å¿…é¡»åŒ¹é…
4. æ•°ç»„ â‰  æŒ‡é’ˆ
5. æ³¨æ„æŒ‡é’ˆè¿ç®—æ­¥é•¿

> **æŒ‡é’ˆä¸æ˜¯â€œéš¾â€ï¼Œè€Œæ˜¯â€œå¯¹å†…å­˜çš„ç²¾ç¡®æ§åˆ¶â€**

---

# å…­ã€ç»“æ„ä½“ï¼ˆStructï¼‰

---

## 6.1 ç»“æ„ä½“å®šä¹‰

### 1ï¸âƒ£ ä»€ä¹ˆæ˜¯ç»“æ„ä½“ï¼Ÿ

> **ç»“æ„ä½“æ˜¯ä¸€ç§ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼Œç”¨æ¥æŠŠâ€œä¸åŒç±»å‹çš„æ•°æ®â€ç»„åˆæˆä¸€ä¸ªæ•´ä½“ã€‚**

å’Œæ•°ç»„çš„åŒºåˆ«ï¼š

* æ•°ç»„ï¼šåŒä¸€ç±»å‹
* ç»“æ„ä½“ï¼š**ä¸åŒç±»å‹**

---

### 2ï¸âƒ£ åŸºæœ¬å®šä¹‰æ–¹å¼

```c
struct Person {
    int age;
    char gender;
    float height;
};
```

#### è¯´æ˜ï¼š

* `struct Person` æ˜¯ä¸€ç§ **ç±»å‹**
* èŠ±æ‹¬å·é‡Œçš„æ˜¯ **æˆå‘˜ï¼ˆmemberï¼‰**

---

### 3ï¸âƒ£ åªå®šä¹‰ç»“æ„ä½“ï¼Œä¸å®šä¹‰å˜é‡

```c
struct Student {
    int id;
    char name[20];
};
```

---

### 4ï¸âƒ£ å®šä¹‰ç»“æ„ä½“çš„åŒæ—¶å®šä¹‰å˜é‡

```c
struct Student {
    int id;
    char name[20];
} s1, s2;
```

---

## 6.2 ç»“æ„ä½“å˜é‡

### 1ï¸âƒ£ å®šä¹‰ç»“æ„ä½“å˜é‡

```c
struct Student s;
```

---

### 2ï¸âƒ£ æˆå‘˜è®¿é—®ï¼ˆç‚¹è¿ç®—ç¬¦ï¼‰

```c
s.id = 1001;
```

---

### 3ï¸âƒ£ åˆå§‹åŒ–

```c
struct Student s = {1001, "Tom"};
```

æˆ–ï¼ˆæ¨èï¼‰ï¼š

```c
struct Student s = {
    .id = 1001,
    .name = "Tom"
};
```

**æŒ‡å®šæˆå‘˜åˆå§‹åŒ–**ï¼ˆå·¥ç¨‹å¼ºçƒˆæ¨èï¼‰

---

## 6.3 ç»“æ„ä½“æŒ‡é’ˆ

### 1ï¸âƒ£ å®šä¹‰ç»“æ„ä½“æŒ‡é’ˆ

```c
struct Student *p;
```

---

### 2ï¸âƒ£ ä½¿ç”¨ `->` è®¿é—®æˆå‘˜

```c
p->id = 1001;
```

ç­‰ä»·äºï¼š

```c
(*p).id = 1001;
```

ğŸ“Œ **`->` æœ¬è´¨æ˜¯è¯­æ³•ç³–**

---

### 3ï¸âƒ£ ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°ï¼ˆæ¨èæŒ‡é’ˆï¼‰

```c
void print_student(struct Student *s)
{
    printf("%d\n", s->id);
}
```

ğŸ“Œ é¿å…å¤§å¯¹è±¡æ‹·è´ï¼Œæé«˜æ•ˆç‡

---

## 6.4 ç»“æ„ä½“å†…å­˜å¯¹é½ï¼ˆé‡ç‚¹ï¼‰

### 1ï¸âƒ£ ä¸ºä»€ä¹ˆè¦å†…å­˜å¯¹é½ï¼Ÿ

> ä¸ºäº†æé«˜ CPU è®¿é—®æ•ˆç‡
> æŸäº›æ¶æ„ **ä¸å¯¹é½è®¿é—®ä¼šç›´æ¥å¼‚å¸¸ï¼ˆåµŒå…¥å¼éå¸¸å¸¸è§ï¼‰**

---

### 2ï¸âƒ£ å¯¹é½è§„åˆ™ï¼ˆå¿…èƒŒï¼‰

1. æˆå‘˜æŒ‰å£°æ˜é¡ºåºæ’åˆ—
2. æ¯ä¸ªæˆå‘˜èµ·å§‹åœ°å€æ˜¯ï¼š

   ```
   min(æˆå‘˜å¤§å°, å¯¹é½å•ä½) çš„æ•´æ•°å€
   ```
3. ç»“æ„ä½“æ€»å¤§å°æ˜¯ **æœ€å¤§å¯¹é½å€¼çš„æ•´æ•°å€**

---

### 3ï¸âƒ£ ç¤ºä¾‹ï¼ˆéå¸¸é‡è¦ï¼‰

```c
struct A {
    char a;   // 1
    int  b;   // 4
    char c;   // 1
};
```

å†…å­˜å¸ƒå±€ï¼š

```text
åç§»
0   a
1   padding
2   padding
3   padding
4   b
5   b
6   b
7   b
8   c
9   padding
10  padding
11  padding
```

```c
sizeof(struct A) == 12
```

---

### 4ï¸âƒ£ æ§åˆ¶å¯¹é½ï¼ˆåµŒå…¥å¼å¸¸ç”¨ï¼‰

```c
#pragma pack(1)
struct B {
    char a;
    int b;
};
#pragma pack()
```

âš ï¸ **æ…ç”¨ï¼Œå¯èƒ½å½±å“æ€§èƒ½**

---

## 6.5 typedef struct

### 1ï¸âƒ£ ä¸ºä»€ä¹ˆè¦ç”¨ typedefï¼Ÿ

```c
struct Student s;
```

å¤ªé•¿ï¼Œä¸åˆ©äºå·¥ç¨‹ç»´æŠ¤ã€‚

---

### 2ï¸âƒ£ å¸¸è§å†™æ³•ï¼ˆæ¨èï¼‰

```c
typedef struct {
    int id;
    char name[20];
} Student;
```

ä½¿ç”¨ï¼š

```c
Student s;
Student *p;
```

ğŸ“Œ **è¿™æ˜¯åµŒå…¥å¼/é©±åŠ¨ä»£ç çš„æ ‡é…å†™æ³•**

---

### 3ï¸âƒ£ å¦ä¸€ç§å†™æ³•ï¼ˆä¿ç•™ tagï¼‰

```c
typedef struct Student {
    int id;
} Student;
```

---

## 6.6 ç»“æ„ä½“åœ¨åµŒå…¥å¼ä¸­çš„åº”ç”¨

### 6.6.1 å¯„å­˜å™¨æ˜ å°„ï¼ˆæ ¸å¿ƒé‡ç‚¹ï¼‰

> **ç”¨ç»“æ„ä½“â€œæè¿°ç¡¬ä»¶å¯„å­˜å™¨å¸ƒå±€â€**

---

### ç¤ºä¾‹ï¼šGPIO å¯„å­˜å™¨æ˜ å°„

```c
typedef struct {
    volatile uint32_t MODER;
    volatile uint32_t OTYPER;
    volatile uint32_t OSPEEDR;
    volatile uint32_t PUPDR;
    volatile uint32_t IDR;
    volatile uint32_t ODR;
} GPIO_TypeDef;
```

---

### å¯„å­˜å™¨åŸºåœ°å€

```c
#define GPIOA_BASE 0x40020000
```

---

### æ˜ å°„æˆç»“æ„ä½“æŒ‡é’ˆ

```c
#define GPIOA ((GPIO_TypeDef *)GPIOA_BASE)
```

---

### ä½¿ç”¨æ–¹å¼ï¼ˆéå¸¸ä¼˜é›…ï¼‰

```c
GPIOA->MODER = 0x55555555;
```

### **æœ¬è´¨ï¼š**

* æŠŠç¡¬ä»¶åœ°å€å½“æˆç»“æ„ä½“
* é€šè¿‡æŒ‡é’ˆè®¿é—®æˆå‘˜
* ç¼–è¯‘å™¨è‡ªåŠ¨å¸®ä½ ç®—åç§»

---

### 6.6.2 ä¸ºä»€ä¹ˆæˆå‘˜è¦ volatileï¼Ÿ

```c
volatile uint32_t ODR;
```

é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–ï¼š

* ç¡¬ä»¶å¯„å­˜å™¨å¯èƒ½â€œéšæ—¶å˜â€
* æ¯æ¬¡è®¿é—®éƒ½å¿…é¡»çœŸå®è¯»å†™

---

## 6.7 æ€»ç»“

> * ç»“æ„ä½“æ˜¯å¼‚æ„æ•°æ®çš„ç»„åˆ
> * æŒ‡é’ˆ + ç»“æ„ä½“æ˜¯å·¥ç¨‹æ ¸å¿ƒ
> * å†…å­˜å¯¹é½ç›´æ¥å½±å“æ€§èƒ½å’Œæ­£ç¡®æ€§
> * å¯„å­˜å™¨æ˜ å°„æ˜¯åµŒå…¥å¼ C çš„çµé­‚

---

å¥½ï¼Œè¿™ä¸€èŠ‚æ­£å¥½æŠŠ **C è¯­è¨€é‡Œâ€œçœ‹èµ·æ¥ç®€å•ï¼Œä½†å·¥ç¨‹é‡Œå¾ˆæœ‰åˆ†é‡â€çš„ä¸¤ç§ç±»å‹ï¼š`enum` å’Œ `union`** ç³»ç»Ÿæ€§åœ°è¡¥é½ã€‚
æˆ‘æŒ‰ **å®šä¹‰ â†’ æœ¬è´¨ â†’ ç”¨æ³• â†’ æ˜“é”™ç‚¹ â†’ åµŒå…¥å¼/å·¥ç¨‹åº”ç”¨** ç»™ä½ ä¸€ä»½**å¯ç›´æ¥è¿›ä½ ç¬”è®°æœ¬çš„æ€»ç»“**ã€‚

---

# ä¸ƒã€æšä¸¾ï¼ˆenumï¼‰

## 7.1 enum çš„å®šä¹‰

```c
enum Color {
    RED,
    GREEN,
    BLUE
};
```

* `RED = 0`
* `GREEN = 1`
* `BLUE = 2`

>  é»˜è®¤ä» **0 å¼€å§‹ï¼Œä¾æ¬¡ +1**

---

## 7.2 enum çš„æœ¬è´¨ï¼ˆéå¸¸é‡è¦ï¼‰

> **enum æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªâ€œæ•´å‹å¸¸é‡é›†åˆâ€**

* åº•å±‚ç±»å‹ï¼š**intï¼ˆæˆ–èƒ½å®¹çº³çš„æœ€å°æ•´å‹ï¼Œç¼–è¯‘å™¨å†³å®šï¼‰**
* **ä¸æ˜¯çœŸæ­£çš„æ–°ç±»å‹**
* ç¼–è¯‘åï¼šæ²¡æœ‰ enum è¿™ä¸ªæ¦‚å¿µï¼Œåªæœ‰æ•´æ•°

```c
enum Color c = RED;
```

ç­‰ä»·äºï¼š

```c
int c = 0;
```

---

## 7.3 æ˜¾å¼èµ‹å€¼

```c
enum State {
    IDLE = 0,
    RUN  = 3,
    STOP = 10
};
```

åé¢çš„æˆå‘˜å¦‚æœæ²¡æŒ‡å®šï¼š

```c
STOP = 10
NEXT = 11
```

---

## 7.4 enum çš„ä½œç”¨ï¼ˆä¸ºä»€ä¹ˆè¦ç”¨ï¼‰

### 1ï¸âƒ£ æé«˜å¯è¯»æ€§

```c
if (state == RUN)   // å¥½
if (state == 3)     // å·®
```

---

### 2ï¸âƒ£ ä»£æ›¿å®å¸¸é‡ï¼ˆæ›´å®‰å…¨ï¼‰

```c
#define RUN 3        // æ— ç±»å‹
enum { RUN = 3 };   // æœ‰ä½œç”¨åŸŸ
```

---

## 7.5 enum ä¸ switchï¼ˆç»å…¸ç»„åˆï¼‰

```c
switch (state) {
case IDLE:
    break;
case RUN:
    break;
}
```

> **çŠ¶æ€æœºæ ¸å¿ƒå†™æ³•**

---

## 7.6 typedef enumï¼ˆå·¥ç¨‹ä¸­æœ€å¸¸è§ï¼‰

```c
typedef enum {
    IDLE,
    RUN,
    STOP
} state_t;

state_t s;
```

âœ”ï¸ **è¿™æ˜¯å·¥ä¸šçº§å†™æ³•**

---

### 1.7 enum çš„å¸¸è§è¯¯åŒº

> enum ä¼šé™åˆ¶å–å€¼èŒƒå›´ï¼Ÿ
> 
> **ä¸ä¼š**

```c
state_t s = 100;   // ç¼–è¯‘å™¨é€šå¸¸ä¸æŠ¥é”™
```

- enum å  1 å­—èŠ‚ï¼Ÿ

- **é€šå¸¸å  int å¤§å°**

---

# å…«ã€å…±ç”¨ä½“ï¼ˆunionï¼‰

---

## 8.1 union çš„å®šä¹‰

```c
union Data {
    int   i;
    float f;
    char  c[4];
};
```

---

## 8.2 union çš„æ ¸å¿ƒæœ¬è´¨ï¼ˆå¿…é¡»ç‰¢è®°ï¼‰

> **æ‰€æœ‰æˆå‘˜å…±äº«åŒä¸€å—å†…å­˜**

* å¤§å° = **æœ€å¤§æˆå‘˜çš„å¤§å°**
* åŒä¸€æ—¶é—´ï¼Œåªèƒ½â€œé€»è¾‘ä¸Šâ€ä½¿ç”¨ä¸€ä¸ªæˆå‘˜

```c
union Data d;
```

å†…å­˜ç¤ºæ„ï¼š

```text
| 4 bytes |
```

---

## 8.3 union çš„å†…å­˜å¤§å°

```c
sizeof(union Data) == max(sizeof(int), sizeof(float), sizeof(char[4]))
```

å¯¹é½åå¯èƒ½æ›´å¤§

---

## 8.4 union çš„è¯»å†™è¡Œä¸ºï¼ˆé‡ç‚¹ï¼‰

```c
union Data d;
d.i = 0x3f800000;
printf("%f", d.f);
```

 **æŒ‰ä½é‡è§£é‡Šï¼ˆtype punningï¼‰**

---

## 8.5 union çš„å…¸å‹ç”¨é€”

#### 1ï¸âƒ£ ä¸åŒæ•°æ®æ ¼å¼çš„â€œè§†è§’åˆ‡æ¢â€

```c
union {
    uint32_t val;
    uint8_t  byte[4];
} u;
```

ç”¨é€”ï¼š

* å¤§å°ç«¯åˆ†æ
* é€šä¿¡åè®®è§£æ

---

#### 2ï¸âƒ£ èŠ‚çœå†…å­˜ï¼ˆåµŒå…¥å¼ï¼‰

```c
union {
    int  temp;
    char buf[64];
} u;
```

ğŸ“Œ åŒä¸€æ—¶åˆ»åªç”¨ä¸€ç§æ•°æ®

---

## 8.6 union + structï¼ˆå·¥ç¨‹ç»å…¸ï¼‰

```c
typedef union {
    uint32_t value;
    struct {
        uint32_t EN  : 1;
        uint32_t MODE: 2;
        uint32_t RES : 29;
    } bit;
} REG_t;
```

**å¯„å­˜å™¨æ˜ å°„ç¥å™¨**

---

## 8.7 union çš„å±é™©ç‚¹

å†™çš„æ˜¯ `i`ï¼Œå´è¯» `f`

```c
d.i = 10;
printf("%f", d.f);  // æœªå®šä¹‰/ä¾èµ–å®ç°
```

é™¤éä½ æ˜ç¡®æ˜¯â€œæŒ‰ä½è§£é‡Šâ€

---

## 8.8 enum + union çš„ç»å…¸ç»„åˆï¼ˆçŠ¶æ€æ•°æ®ï¼‰

```c
typedef enum {
    TYPE_INT,
    TYPE_FLOAT
} type_t;

typedef struct {
    type_t type;
    union {
        int   i;
        float f;
    } data;
} value_t;
```

ä½¿ç”¨ï¼š

```c
value_t v;
v.type = TYPE_INT;
v.data.i = 10;
```

 **C è¯­è¨€å®ç°â€œå˜ä½“ç±»å‹â€çš„æ ‡å‡†æ–¹å¼**

---

## 8.9 enum vs union vs struct å¯¹æ¯”æ€»ç»“

| ç±»å‹     | æ ¸å¿ƒä½œç”¨             |
| ------ | ---------------- |
| enum   | **æ•´æ•°è¯­ä¹‰åŒ–ï¼ˆçŠ¶æ€/æ¨¡å¼ï¼‰** |
| struct | **åŒæ—¶å­˜åœ¨çš„æˆå‘˜**      |
| union  | **äº’æ–¥å­˜åœ¨çš„æˆå‘˜ï¼ˆçœå†…å­˜ï¼‰** |

---

# ä¹ã€å†…å­˜ä¸ç¼–è¯‘ (Memory & Complie)

---

## 9.1 æ ˆ / å † / å…¨å±€åŒº

### 9.1.1 ç¨‹åºè¿è¡Œæ—¶çš„å†…å­˜æ•´ä½“å¸ƒå±€ï¼ˆé€»è¾‘è§†è§’ï¼‰

å…¸å‹è¿›ç¨‹å†…å­˜æ¨¡å‹ï¼ˆä»ä½åœ°å€åˆ°é«˜åœ°å€ï¼‰ï¼š

```text
.text      ï¼ˆä»£ç æ®µï¼‰
.rodata    ï¼ˆåªè¯»æ•°æ®ï¼‰
.data      ï¼ˆå·²åˆå§‹åŒ–å…¨å±€å˜é‡ï¼‰
.bss       ï¼ˆæœªåˆå§‹åŒ–å…¨å±€å˜é‡ï¼‰
heap       ï¼ˆå †ï¼Œå‘ä¸Šå¢é•¿ï¼‰
â†“
â†‘
stack      ï¼ˆæ ˆï¼Œå‘ä¸‹å¢é•¿ï¼‰
```

æ³¨ï¼šä¸Šå›¾æè¿°çš„æ˜¯â€œå…¸å‹è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€çš„ç©ºé—´å¸ƒå±€â€

å…·ä½“æƒ…å†µæ˜¯æ“ä½œç³»ç»Ÿã€ç¼–è¯‘å™¨ã€é“¾æ¥è„šæœ¬çš„å…±åŒå†³å®šç»“æœ

---

### 9.1.2 æ ˆï¼ˆStackï¼‰

#### ç‰¹ç‚¹ï¼š

* è‡ªåŠ¨åˆ†é…ã€è‡ªåŠ¨é‡Šæ”¾
* æ¯æ¬¡å‡½æ•°è°ƒç”¨éƒ½ä¼šåˆ›å»º **æ ˆå¸§**
* é€Ÿåº¦å¿«ï¼Œç©ºé—´æœ‰é™

#### å­˜æ”¾å†…å®¹ï¼š

* å±€éƒ¨å˜é‡
* å‡½æ•°å‚æ•°
* è¿”å›åœ°å€
* ä¿å­˜çš„å¯„å­˜å™¨

```c
void func(void)
{
    int a = 10;   // æ ˆä¸Š
}
```

âš ï¸ é—®é¢˜ï¼š

* æ ˆæº¢å‡ºï¼ˆé€’å½’è¿‡æ·±ã€å¤§æ•°ç»„ï¼‰

---

### 9.1.3 å †ï¼ˆHeapï¼‰

ç‰¹ç‚¹ï¼š

* æ‰‹åŠ¨ç”³è¯· / æ‰‹åŠ¨é‡Šæ”¾
* ç”Ÿå‘½å‘¨æœŸç”±ç¨‹åºå‘˜æ§åˆ¶
* ç©ºé—´å¤§ä½†é€Ÿåº¦æ…¢

```c
int *p = malloc(sizeof(int));  // å †
```

âš ï¸ å¸¸è§é—®é¢˜ï¼š

* å†…å­˜æ³„æ¼
* é‡æŒ‡é’ˆ
* ç¢ç‰‡åŒ–ï¼ˆåµŒå…¥å¼å°¤ä¸ºä¸¥é‡ï¼‰

---

### 9.1.4 å…¨å±€åŒºï¼ˆé™æ€åŒºï¼‰

å­˜æ”¾ï¼š

* å…¨å±€å˜é‡
* static å˜é‡

```c
int g = 10;          // .data
static int s;        // .bss
```

ç‰¹ç‚¹ï¼š

* ç¨‹åºå¯åŠ¨æ—¶åˆ†é…
* ç¨‹åºç»“æŸæ—¶é‡Šæ”¾

---

## 9.2 malloc / freeåŸç†

### 9.2.1 malloc æ˜¯å¹²å˜›çš„ï¼Ÿ

```c
void *malloc(size_t size);
```

> å‘ **å †** ç”³è¯·ä¸€å—è¿ç»­å†…å­˜

---

### 9.2.2 malloc çš„æœ¬è´¨

> malloc æœ¬èº«ä¸æ˜¯ç³»ç»Ÿè°ƒç”¨
> 
> å®ƒæ˜¯ **C åº“å¯¹åº•å±‚å†…å­˜ç®¡ç†çš„å°è£…**

åº•å±‚å¯èƒ½ä½¿ç”¨ï¼š

* `brk / sbrk`
* `mmap`
* æˆ–åµŒå…¥å¼é‡Œçš„ **é™æ€å†…å­˜æ± **

---

### 9.2.3 malloc å†…éƒ¨åšäº†ä»€ä¹ˆï¼Ÿ

ç®€åŒ–æµç¨‹ï¼š

```text
1. æŸ¥æ‰¾ç©ºé—²å†…å­˜å—
2. è‹¥è¶³å¤Ÿå¤§ â†’ åˆ‡å‰²
3. æ ‡è®°ä¸ºå·²å ç”¨
4. è¿”å›æŒ‡é’ˆ
```

---

### 9.2.4 free çš„æœ¬è´¨

```c
free(p);
```

åªæ˜¯æŠŠå†…å­˜æ ‡è®°ä¸ºâ€œå¯å¤ç”¨â€, å¹¶ä¸ä¸€å®šç«‹åˆ»å½’è¿˜ç»™ OS

---

### 9.2.5 åµŒå…¥å¼é‡Œçš„ç°å®é—®é¢˜

âš ï¸ å¾ˆå¤šåµŒå…¥å¼é¡¹ç›®ï¼š

* ç¦ç”¨ malloc/free
* ä½¿ç”¨é™æ€å†…å­˜æ± 

åŸå› ï¼š

* å†…å­˜ç¢ç‰‡
* ä¸å¯é¢„æµ‹æ€§

---

## 9.3 .text / .data / .bssï¼ˆç¼–è¯‘ & é“¾æ¥è§†è§’ï¼‰

è¿™æ˜¯ **ç¼–è¯‘å™¨ + é“¾æ¥å™¨çœ¼é‡Œçš„ç¨‹åº**

---

### 9.3.1 .text æ®µï¼ˆä»£ç æ®µï¼‰

å­˜æ”¾ï¼š

* æœºå™¨æŒ‡ä»¤
* é€šå¸¸åªè¯»

```c
int add(int a, int b)
{
    return a + b;
}
```

ğŸ‘‰ åœ¨ `.text`

---

### 9.3.2 .data æ®µï¼ˆå·²åˆå§‹åŒ–å…¨å±€æ•°æ®ï¼‰

ç‰¹ç‚¹ï¼š

* æœ‰åˆå§‹å€¼
* å ç”¨ Flash + RAM

```c
int g = 10;
static int s = 5;
```

---

### 9.3.3 .bss æ®µï¼ˆæœªåˆå§‹åŒ–å…¨å±€æ•°æ®ï¼‰

ç‰¹ç‚¹ï¼š

* åˆå§‹å€¼é»˜è®¤ä¸º 0
* **ä¸å  Flash**
* å¯åŠ¨æ—¶æ¸…é›¶

```c
int g;
static int s;
```

---

### 9.3.4 .rodataï¼ˆåªè¯»æ•°æ®ï¼‰

å­˜æ”¾ï¼š

* å­—ç¬¦ä¸²å¸¸é‡
* const å…¨å±€å˜é‡

```c
const char *s = "hello";
```

---

### 9.3.5 ä¸€ä¸ªéå¸¸é‡è¦çš„å¯¹æ¯”

| æ®µ       | å  Flash | å  RAM |
| ------- | ------- | ----- |
| .text   | âœ…       | âŒ     |
| .rodata | âœ…       | âŒ     |
| .data   | âœ…       | âœ…     |
| .bss    | âŒ       | âœ…     |

---

## 9.4 ELF æ–‡ä»¶ç»“æ„ï¼ˆç¨‹åºæ–‡ä»¶æœ¬ä½“ï¼‰

### 9.4.1 ä»€ä¹ˆæ˜¯ ELFï¼Ÿ

> **ELFï¼ˆExecutable and Linkable Formatï¼‰**
> æ˜¯ Linux / åµŒå…¥å¼ä¸‹æœ€å¸¸è§çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼

---

### 9.4.2 ELF çš„ä¸»è¦ç»„æˆ

```text
ELF Header
Program Header Table
Section Header Table
Sectionsï¼ˆ.text .data .bss â€¦ï¼‰
```

---

### 9.4.3 Section vs Segmentï¼ˆé‡ç‚¹ï¼‰

| æ¦‚å¿µ      | ç”¨é€”    |
| ------- | ----- |
| Section | ç»™é“¾æ¥å™¨ç”¨ |
| Segment | ç»™åŠ è½½å™¨ç”¨ |

Section ä¼šè¢«â€œæ‰“åŒ…â€æˆ Segment

---

### 9.4.4 å¸¸è§ section

| Section | ä½œç”¨     |
| ------- | ------ |
| .text   | ä»£ç      |
| .data   | å·²åˆå§‹åŒ–æ•°æ® |
| .bss    | æœªåˆå§‹åŒ–æ•°æ® |
| .rodata | å¸¸é‡     |
| .symtab | ç¬¦å·è¡¨    |
| .strtab | å­—ç¬¦ä¸²è¡¨   |

---

### 9.4.5 å·¥ç¨‹å®è·µ

```bash
readelf -h a.out
readelf -S a.out
objdump -h a.out
```

---

## 9.5 ä¸€ä¸ªâ€œå…¨é“¾è·¯â€ç†è§£ï¼ˆéå¸¸é‡è¦ï¼‰

```text
.c
 â†“ ç¼–è¯‘
.o        ï¼ˆsection çº§ï¼‰
 â†“ é“¾æ¥
ELF       ï¼ˆsection + segmentï¼‰
 â†“ åŠ è½½
å†…å­˜å¸ƒå±€ï¼ˆtext / data / bss / heap / stackï¼‰
```

---

## 9.6 æ€»ç»“

* æ ˆç”¨äºå‡½æ•°è°ƒç”¨ï¼Œå †ç”¨äºåŠ¨æ€åˆ†é…
* å…¨å±€å˜é‡ä½äº data / bss
* .text / .data / .bss æ˜¯ç¼–è¯‘é“¾æ¥è§†è§’
* æ ˆ / å † æ˜¯è¿è¡Œæ—¶è§†è§’
* ELF æ˜¯ç¨‹åºåœ¨ç£ç›˜ä¸Šçš„æœ€ç»ˆå½¢æ€

---

## å…«ã€å¸¸è§çš„é—®é¢˜ä¸å‘

---

# åã€ æ•°æ®ç±»å‹è¿›é˜¶ç‰ˆ(typedefä¼˜åŒ–åçš„)

## 10.1 è¿™äº›ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿ

åƒä¸‹é¢è¿™äº›ï¼š

```c
uint8_t   uint16_t   uint32_t   uint64_t
int8_t    int16_t    int32_t    int64_t
```

å®ƒä»¬ä¸æ˜¯ C è¯­è¨€â€œåŸç”Ÿå…³é”®å­—â€ï¼Œè€Œæ˜¯ï¼š

> **é€šè¿‡ typedef å®šä¹‰çš„ã€å…·æœ‰â€œç¡®å®šå­—é•¿â€çš„æ•´æ•°ç±»å‹**

---

## 10.2  å®ƒä»¬ä»å“ªé‡Œæ¥ï¼Ÿ

### 1ï¸âƒ£ å®šä¹‰åœ¨æ ‡å‡†å¤´æ–‡ä»¶ä¸­

```c
#include <stdint.h>
```

è¿™æ˜¯ **C99 æ ‡å‡†**å¼•å…¥çš„å¤´æ–‡ä»¶ã€‚

---

### 2ï¸âƒ£ æœ¬è´¨æ˜¯ typedef

åœ¨ `<stdint.h>` é‡Œï¼ˆç®€åŒ–ç†è§£ï¼‰ï¼š

```c
typedef unsigned int  uint32_t;
typedef signed int    int32_t;
```

å®é™…æ˜ å°„å–å†³äºå¹³å°ï¼Œä½†æ ‡å‡†ä¿è¯ï¼š

> `uint32_t` **ä¸€å®šæ˜¯ 32 ä½æ— ç¬¦å·æ•´æ•°**

---

## 10.3 ä¸ºä»€ä¹ˆ C æ ‡å‡†è¦â€œäººä¸ºå®šä¹‰â€è¿™äº›ç±»å‹ï¼Ÿ

### 1ï¸âƒ£ å› ä¸º C çš„åŸºç¡€ç±»å‹å¤§å°ä¸å›ºå®š

| ç±»å‹    | å¤§å°æ˜¯å¦å›ºå®š  |
| ----- | ------- |
| char  | â‰¥ 1 å­—èŠ‚  |
| short | â‰¥ char  |
| int   | â‰¥ short |
| long  | â‰¥ int   |

**æ²¡æœ‰ä»»ä½•ä¸€æ¡ä¿è¯ int = 32 ä½**

---

### 2ï¸âƒ£ ä½†å·¥ç¨‹ä¸–ç•Œéœ€è¦â€œç»å¯¹ç¡®å®šâ€

* å¯„å­˜å™¨ï¼š32 bit
* åè®®å­—æ®µï¼š16 bit
* æ–‡ä»¶æ ¼å¼ï¼š8 / 32 bit
* ç½‘ç»œåŒ…ï¼šbit çº§å¯¹é½

ğŸ‘‰ **ä¸èƒ½é  int ç¢°è¿æ°”**

---

## 10.4 æ ‡å‡†æ•´æ•°ç±»å‹çš„åˆ†ç±»ï¼ˆéå¸¸é‡è¦ï¼‰

### 1 ç²¾ç¡®å®½åº¦ç±»å‹ï¼ˆExact-widthï¼‰

> **å¦‚æœå¹³å°æ”¯æŒï¼Œæ‰å®šä¹‰**

```c
uint8_t   int8_t
uint16_t  int16_t
uint32_t  int32_t
uint64_t  int64_t
```

#### ç‰¹ç‚¹ï¼š

* ç²¾ç¡®ä½å®½
* å·¥ç¨‹ / åµŒå…¥å¼é¦–é€‰
* å¯„å­˜å™¨ã€åè®®ã€æ–‡ä»¶æ ¼å¼

---

### 2 è‡³å°‘å®½åº¦ç±»å‹ï¼ˆMinimum-widthï¼‰

```c
uint_least32_t
int_least16_t
```

å«ä¹‰ï¼š

* è‡³å°‘è¿™ä¹ˆå¤šä½
* å¹³å°ä¸æ”¯æŒç²¾ç¡®ç±»å‹æ—¶çš„å…œåº•æ–¹æ¡ˆ

---

### 3 æœ€å¿«ç±»å‹ï¼ˆFastestï¼‰

```c
uint_fast32_t
int_fast8_t
```

#### å«ä¹‰ï¼š

* â‰¥ æŒ‡å®šä½å®½
* åœ¨å½“å‰å¹³å°**è®¿é—®æœ€å¿«**

---

## 10.5 æœ€å¸¸è§ typedef ç±»å‹é€ŸæŸ¥è¡¨

| ç±»å‹       | å«ä¹‰      |
| -------- | ------- |
| uint8_t  | 8 ä½æ— ç¬¦å·  |
| int8_t   | 8 ä½æœ‰ç¬¦å·  |
| uint16_t | 16 ä½æ— ç¬¦å· |
| uint32_t | 32 ä½æ— ç¬¦å· |
| uint64_t | 64 ä½æ— ç¬¦å· |

---

## 10.6 åœ¨åµŒå…¥å¼ä¸­çš„å…¸å‹ç”¨æ³•ï¼ˆé‡ç‚¹ï¼‰

### 1 å¯„å­˜å™¨æ˜ å°„

```c
typedef struct {
    volatile uint32_t MODER;
    volatile uint32_t ODR;
} GPIO_TypeDef;
```

> å¿…é¡»ç”¨ `uint32_t`ï¼Œä¸èƒ½ç”¨ `int`

---

### 2 ä½æ“ä½œ

```c
uint32_t reg;
reg |= (1U << 5);
```

---

### 3 åè®® / æ•°æ®å¸§

```c
typedef struct {
    uint8_t  head;
    uint16_t len;
    uint32_t crc;
} frame_t;
```

---

## 10.7 ä¸ºä»€ä¹ˆä¸ç”¨ unsigned intï¼Ÿ

```c
unsigned int reg;   // âŒ ä¸å®‰å…¨
uint32_t reg;       // âœ… å·¥ç¨‹çº§
```

åŸå› ï¼š

* `unsigned int` ä½å®½ä¸ç¡®å®š
* ç§»æ¤å¹³å°å¯èƒ½ç›´æ¥å‡º Bug

å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼š

> `uint32_t` ä¸æ˜¯ç¼–è¯‘å™¨å†…å»º
> 
> æ˜¯æ ‡å‡†åº“ç”¨ typedef å°è£…çš„

**C è¯­è¨€çš„å¼ºå¤§ä¹‹å¤„å°±åœ¨äºâ€œå¯è¢«è‡ªå·±æ‰©å±•â€**

---

## 10.8 å·¥ç¨‹ä¸­å¸¸è§çš„å†å°è£…

```c
typedef uint32_t u32;
typedef volatile uint32_t __IO;
```

è¿™å±äºï¼š

* é¡¹ç›®çº§ / å‚å•†çº§ typedef
* å»ºç«‹åœ¨ `stdint.h` ä¹‹ä¸Š

---

